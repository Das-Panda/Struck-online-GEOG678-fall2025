<!DOCTYPE html>
<html>
<head>
    <title>Struck â€“ TAMU Custom Web Map</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Leaflet CSS -->
    <link rel="stylesheet"
          href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
          integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
          crossorigin=""/>

    <style>
        html, body {
            height: 100%;
            margin: 0;
        }
        #map {
            width: 100%;
            height: 100%;
        }
    </style>
</head>

<body>

<div id="map"></div>

<!-- Leaflet JS -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
        integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
        crossorigin=""></script>

<script>
    // ============================
    // Base map & tile layer
    // ============================
    var map = L.map('map').fitWorld();

    L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 19,
        attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);

    // ============================
    // TAMU landmark coordinates
    // ============================
    var kyleField = [30.6084, -96.3402];
    var omBuilding = [30.6179, -96.3386];
    var academicBuilding = [30.6159, -96.3413];

    // ============================
    // Geolocation (locate function)
    // ============================
    map.locate({ setView: true, maxZoom: 16 });

    function onLocationFound(e) {
        var radius = e.accuracy / 2;

        L.marker(e.latlng).addTo(map)
            .bindPopup("You are within " + Math.round(radius) + " meters of this point.")
            .openPopup();

        L.circle(e.latlng, radius).addTo(map);
    }

    function onLocationError(e) {
        // If geolocation fails, center the map on Kyle Field
        map.setView(kyleField, 16);
        alert("Location access was denied or unavailable. Centering map on Kyle Field.");
    }

    map.on('locationfound', onLocationFound);
    map.on('locationerror', onLocationError);

    // ============================
    // Circle around Kyle Field
    // ============================
    var kyleCircle = L.circle(kyleField, {
        color: 'maroon',
        fillColor: '#800000',
        fillOpacity: 0.4,
        radius: 250   // meters
    }).addTo(map);

    kyleCircle.bindPopup("<b>Kyle Field</b><br>Home of the Fightin' Texas Aggies.");

    // ============================
    // Custom icons for O&M & Academic
    // ============================
    // Using Leaflet's sample leaf icons as "custom" icons
    var tamuIcon = L.Icon.extend({
        options: {
            shadowUrl: 'https://leafletjs.com/examples/custom-icons/leaf-shadow.png',
            iconSize:     [38, 95],
            shadowSize:   [50, 64],
            iconAnchor:   [22, 94],
            shadowAnchor: [4, 62],
            popupAnchor:  [-3, -76]
        }
    });

    var omIcon = new tamuIcon({
        iconUrl: 'https://leafletjs.com/examples/custom-icons/leaf-green.png'
    });

    var academicIcon = new tamuIcon({
        iconUrl: 'https://leafletjs.com/examples/custom-icons/leaf-red.png'
    });

    // O&M Building marker
    var omMarker = L.marker(omBuilding, { icon: omIcon }).addTo(map);
    omMarker.bindPopup("<b>O&M Building</b><br>Oceanography & Meteorology.");

    // Academic Building marker
    var academicMarker = L.marker(academicBuilding, { icon: academicIcon }).addTo(map);
    academicMarker.bindPopup("<b>Academic Building</b><br>Historic TAMU landmark in the heart of campus.");

    // ============================
    // Click event showing coordinates in a popup
    // ============================
    var clickPopup = L.popup();

    function onMapClick(e) {
        var lat = e.latlng.lat.toFixed(5);
        var lng = e.latlng.lng.toFixed(5);

        clickPopup
            .setLatLng(e.latlng)
            .setContent("Coordinates:<br>Lat: " + lat + "<br>Lng: " + lng)
            .openOn(map);
    }

    map.on('click', onMapClick);

</script>

</body>
</html>
